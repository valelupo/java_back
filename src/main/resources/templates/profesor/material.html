<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Registrar Material</title>

    <script>
        let materiales = [];

        function agregarMaterial() {
            const archivo = document.getElementById("archivo").files[0];
            const descripcion = document.getElementById("descripcion").value;

            if (!archivo || !descripcion) {
                alert("Completá todos los campos antes de agregar otro.");
                return;
            }

            const index = materiales.length;
            materiales.push({ archivo, descripcion });

            // Mostrar en lista
            const lista = document.getElementById("listaMateriales");
            const item = document.createElement("li");
            item.textContent = `Material n° ${index + 1}: ${descripcion} `;

            const btnEliminar = document.createElement("button");
            // btnEliminar.className = "btn-eliminar";
            btnEliminar.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                </svg>
            `;


            btnEliminar.onclick = () => {
                materiales.splice(index, 1);
                item.remove();
                actualizarLista();
            };

            // btnEliminar.appendChild(icon);
            item.appendChild(btnEliminar);
            lista.appendChild(item);

            // Limpiar campos
            document.getElementById("archivo").value = "";
            document.getElementById("descripcion").value = "";
        }

        function actualizarLista() {
            const lista = document.getElementById("listamateriales");
            lista.innerHTML = "";
            materiales.forEach((doc, i) => {
                const item = document.createElement("li");
                item.textContent = `Documento ${i + 1}: ${doc.descripcion} `;

                const btnEliminar = document.createElement("button");
                btnEliminar.className = "btn-eliminar";
                btnEliminar.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                        <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                    </svg>
                `;

                // btnEliminar.textContent = "Eliminar";
                // btnEliminar.className = "btn-eliminar";
    
                btnEliminar.onclick = () => {
                    materiales.splice(i, 1);
                    actualizarLista();
                };

                //btnEliminar.appendChild(icon);
                item.appendChild(btnEliminar);
                lista.appendChild(item);
            });
        }

        function enviarmateriales() {
            const archivo = document.getElementById("archivo").files[0];
            const descripcion = document.getElementById("descripcion").value;

            // Si no se presionó "Ingresar otro", agregamos el material actual
            if (archivo && descripcion) {
                materiales.push({ archivo, descripcion });
            }

            if (materiales.length === 0) {
                alert("No hay materiales para enviar.");
                return;
            }

            const formData = new FormData();

            materiales.forEach((mat) => {
                formData.append("archivos", mat.archivo);
                formData.append("descripciones", mat.descripcion);
            });

            fetch("/material/registro", {
                method: "POST",
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    alert("Materiales cargados correctamente.");
                    window.location.href = "/profesor/home";
                } else {
                    alert("Error al cargar materiales.");
                }
            });
        }
    </script>
</head>

<body>

    <div>
        <h2>Cargar Nuevo Material</h2>
        <form id="formMateriales" enctype="multipart/form-data">
            <input type="file" id="archivo" accept=".pdf" />
            <input type="text" id="descripcion" placeholder="Descripción"/>
            <div>
                <button type="button" onclick="agregarMaterial()">Ingresar otro</button>
                <button type="button" onclick="enviarMateriales()">Aceptar</button>
            </div>
    
        </form>

        <h4>Materiales agregados:</h4>
        <ul id="listaMateriales"></ul>

        <section>
            <div>
                <a href="/src/main/resources/templates/profesor/home.html">Volver</a>
            </div>
        </section>
    </div>

   
</body>
</html>

